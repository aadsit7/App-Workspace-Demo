<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recast — Delivery Flow (Motorcycle Rider)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- lottie-web (required for lottie.loadAnimation) -->
  <script src="https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js"></script>

  <!-- confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.4/dist/confetti.browser.min.js"></script>

  <style>
    :root { --ease: cubic-bezier(0.2,0.8,0.2,1); }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    @keyframes tilePulse {
      0%   { transform: scale(0.75); background:#e5e7eb; opacity: .45; }
      55%  { transform: scale(1.0);  background:#2563eb; opacity: 1; }
      100% { transform: scale(0.92); background:#e5e7eb; opacity: .9; }
    }
    @keyframes barGrow { to { transform: scaleX(1); } }
    @keyframes boltDrop { to { transform: scaleY(1); } }
    @keyframes fadeUpIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    .run [data-anim="tilePulse"] { animation: tilePulse 1s var(--ease) var(--d,0s) 1 forwards; }
    .run [data-anim="barGrow"]  { animation: barGrow .9s var(--ease) var(--d,0s) 1 forwards; }
    .run [data-anim="boltDrop"] { animation: boltDrop .9s var(--ease) var(--d,0s) 1 forwards; }
    .run #flowSuccess { animation: fadeUpIn 450ms var(--ease) 1 forwards; }

    .tile {
      width: .4rem; height: .4rem;
      border-radius: 2px;
      background: #e5e7eb;
      opacity: .9;
      transform: scale(.75);
    }
    .bar {
      height: .22rem;
      border-radius: 2px;
      transform-origin: left;
      transform: scaleX(0);
      background: linear-gradient(to right, #2563eb, #1d4ed8);
    }
    .bolt {
      width: .22rem;
      border-radius: 2px;
      transform-origin: top;
      transform: scaleY(0);
      background: linear-gradient(to bottom, #111827, #2563eb);
    }

    /* Route overlay */
    #routeLayer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 4;
    }
    #routePath {
      fill: none;
      stroke: rgba(37,99,235,.45);
      stroke-width: 3.25;
      stroke-linecap: round;
      stroke-dasharray: 6 7;
    }
    #routeGlow {
      fill: none;
      stroke: rgba(37,99,235,.16);
      stroke-width: 9;
      stroke-linecap: round;
    }
    #routeTrace {
      fill: none;
      stroke: rgba(16,185,129,.9);
      stroke-width: 3.25;
      stroke-linecap: round;
      stroke-dasharray: 1;
      stroke-dashoffset: 0;
      opacity: 0;
    }

    /* Rider */
    #rider {
      position: absolute;
      width: 78px;
      height: 78px;
      left: 0;
      top: 0;
      opacity: 0;
      z-index: 6;
      pointer-events: none;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.18));
      transform: translate(-9999px,-9999px);
    }
    #rider .bubble {
      position: absolute;
      right: -6px;
      top: -10px;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      color: #111827;
      opacity: 0;
      transform: translateY(3px);
      transition: opacity 220ms var(--ease), transform 220ms var(--ease);
      white-space: nowrap;
    }
    #rider.show-bubble .bubble { opacity: 1; transform: translateY(0); }

    #riderLottie {
      width: 78px;
      height: 78px;
    }

    /* End user state */
    .highlighted {
      border-color: rgba(16,185,129,.9) !important;
      box-shadow: 0 0 0 3px rgba(16,185,129,.18);
      transition: box-shadow 260ms var(--ease), border-color 260ms var(--ease);
    }
    .processed {
      background: #ecfdf5 !important;
      border-color: #d1fae5 !important;
      color: #065f46 !important;
      transition: background 260ms var(--ease), border-color 260ms var(--ease), color 260ms var(--ease);
    }

    @media (prefers-reduced-motion: reduce) {
      .run [data-anim] { animation: none !important; }
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50 text-gray-900">
  <div class="mx-auto max-w-6xl px-6 lg:px-12 py-8">
    <header class="mb-5">
      <h1 class="text-4xl md:text-5xl font-semibold leading-tight">
        <span class="text-blue-600">Re</span>cast Application Workspace
      </h1>
      <p class="mt-2 max-w-3xl text-base leading-relaxed text-gray-700">
        The motorcycle rider now *visibly delivers* from apps → control plane → end user. Confetti still lands after processing completes.
      </p>
    </header>

    <section class="grid grid-cols-1 gap-4">
      <div class="relative rounded-2xl bg-white shadow-md p-4">
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2">
            <span class="h-7 w-7 rounded-lg grid place-items-center bg-blue-600">
              <i data-lucide="layers" class="h-4 w-4 text-white"></i>
            </span>
            <div>
              <div class="text-sm font-semibold">Application Delivery Flow</div>
              <div class="text-[12px] text-gray-600">Motorcycle delivery + staged policy routing</div>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button id="btnStart"
              class="bg-blue-600 text-white px-3 py-1.5 text-[12px] font-semibold rounded-full hover:bg-blue-700 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2">
              Start
            </button>
            <button id="btnReset"
              class="bg-transparent text-gray-900 border-2 border-gray-900 px-3 py-1.5 text-[12px] font-semibold rounded-full hover:text-blue-600 hover:border-blue-600 focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2">
              Reset
            </button>
          </div>
        </div>

        <div class="mt-3 flex items-center justify-center gap-3 text-[13px] font-medium">
          <div class="flex items-center gap-1">
            <i data-lucide="building" class="w-4 h-4 text-gray-600"></i>
            <span>Existing App Managers</span>
          </div>
          <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
          <div class="flex items-center gap-1">
            <i data-lucide="truck" class="w-4 h-4 text-blue-600"></i>
            <span>Delivery Control Plane</span>
          </div>
          <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
          <div class="flex items-center gap-1">
            <i data-lucide="user" class="w-4 h-4 text-gray-600"></i>
            <span>User</span>
          </div>
        </div>

        <div class="mt-2 text-center bg-blue-50 p-2 rounded-lg text-[12px] text-gray-700">
          Recast sits between your tools and your users, standardizing delivery without changing app sources.
        </div>

        <div id="flowCard" class="relative mt-3 rounded-xl border border-gray-200 bg-gradient-to-b from-white to-gray-50 shadow-inner p-3 overflow-hidden">

          <!-- route overlay -->
          <svg id="routeLayer" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
            <path id="routeGlow" d="" />
            <path id="routePath" d="" />
            <path id="routeTrace" d="" />
          </svg>

          <!-- rider -->
          <div id="rider" aria-hidden="true">
            <div class="bubble" id="riderBubble">Delivering…</div>
            <div id="riderLottie"></div>
          </div>

          <!-- counters -->
          <div id="counters" class="hidden mb-3 grid grid-cols-3 gap-2 text-[12px] text-center text-gray-700">
            <div><span class="font-semibold tabular-nums" id="appsProcessed">0</span> apps processed</div>
            <div><span class="font-semibold tabular-nums" id="timeSaved">0</span> hours saved</div>
            <div><span class="font-semibold tabular-nums" id="ticketsAvoided">0</span> tickets avoided</div>
          </div>

          <!-- Source apps (left) -->
          <div class="space-y-2">
            <div class="grid grid-cols-[12ch_1fr] gap-2 items-center border-t border-gray-200 pt-2 first:border-t-0 first:pt-0">
              <div class="text-[11px] uppercase text-gray-700 flex items-center gap-1.5">
                <i data-lucide="folder" class="w-3 h-3"></i>CORE
              </div>
              <div id="cat-core" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="grid grid-cols-[12ch_1fr] gap-2 items-center border-t border-gray-200 pt-2">
              <div class="text-[11px] uppercase text-gray-700 flex items-center gap-1.5">
                <i data-lucide="folder" class="w-3 h-3"></i>SECURITY
              </div>
              <div id="cat-security" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="grid grid-cols-[12ch_1fr] gap-2 items-center border-t border-gray-200 pt-2">
              <div class="text-[11px] uppercase text-gray-700 flex items-center gap-1.5">
                <i data-lucide="folder" class="w-3 h-3"></i>ENTERPRISE
              </div>
              <div id="cat-enterprise" class="flex flex-wrap gap-2"></div>
            </div>
          </div>

          <!-- Processing buckets (middle) -->
          <div class="mt-4 grid grid-cols-3 gap-2" aria-hidden="true" id="platformsSection">
            ${["Existing Platforms","Staged Rings","Access & Policy"].map((title,i)=>`
              <div class="rounded-xl border border-gray-200 bg-gray-50 p-2 relative">
                <div class="text-[11px] text-gray-700">${title}</div>
                <div class="mt-1 grid grid-cols-10 gap-1" id="flowConn${i}"></div>
                <div class="mt-2 bar" data-anim="barGrow" style="--d:${3 + i*0.5}s"></div>
              </div>
            `).join("")}
          </div>

          <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true" id="groupsSection">
            ${["Business Unit","Subsidiary","Region"].map((title,i)=>`
              <div class="rounded-xl border border-gray-200 bg-gray-50 p-2 relative">
                <div class="text-[11px] text-gray-700">${title}</div>
                <div class="mt-1 grid grid-cols-8 gap-1" id="flowGrp${i}"></div>
                <div class="mx-auto mt-2 bolt h-12" data-anim="boltDrop" style="--d:${5 + i*0.5}s"></div>
              </div>
            `).join("")}
          </div>

          <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true" id="devicesSection">
            ${[
              {icon:"monitor-smartphone", label:"Windows & macOS"},
              {icon:"laptop", label:"VDI / Web"},
              {icon:"smartphone", label:"Mobile"}
            ].map((d,i)=>`
              <div class="rounded-xl border border-gray-200 bg-gray-50 p-2 text-center relative">
                <i data-lucide="${d.icon}" class="h-5 w-5 text-gray-600 inline-block"></i>
                <div class="mt-1 grid grid-cols-6 gap-1" id="flowDev${i}"></div>
                <div class="mt-1 text-[10px] text-gray-700">${d.label}</div>
              </div>
            `).join("")}
          </div>

          <!-- End user (right target) -->
          <div class="mt-4">
            <div id="endUserCard" class="rounded-xl border border-gray-200 bg-gray-50 p-3">
              <div class="flex items-center gap-2">
                <div id="endUserAvatar" class="h-8 w-8 grid place-items-center font-semibold rounded-full bg-red-600 text-white">U</div>
                <div class="text-[13px]">
                  <div class="font-medium">End user</div>
                  <div id="endUserMessage" class="text-gray-700">Waiting on app readiness…</div>
                </div>
              </div>

              <div class="mt-3 border border-gray-200 bg-white rounded-2xl p-3">
                <i data-lucide="laptop" class="h-4.5 w-4.5 text-gray-600"></i>
                <div class="mt-1 text-[10px] text-gray-600">
                  Right app, right policy, right device — regardless of backend platform.
                </div>
              </div>
            </div>

            <div id="flowSuccess" class="mt-2 hidden inline-flex items-center gap-2 text-[13px] text-emerald-600 opacity-0">
              <i data-lucide="sparkles" class="h-4 w-4"></i>
              <span class="font-medium">Configured once → delivered everywhere.</span>
            </div>
          </div>

        </div>
      </div>
    </section>
  </div>

<script>
  const $ = (id) => document.getElementById(id);
  const prefersReducedMotion = () =>
    window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  // Replace this with YOUR motorcycle-delivery JSON if you already have one.
  // The animation should look like a rider moving/rolling in place (we move the container across the screen).
  const RIDER_LOTTIE_URL = "https://assets2.lottiefiles.com/packages/lf20_touohxv0.json";

  const CATALOG = {
    core: [
      { l:"W", c:"#185ABD" }, { l:"X", c:"#107C41" }, { l:"P", c:"#D24726" },
      { l:"O", c:"#106EBE" }, { l:"T", c:"#5B53D6" }, { l:"G", c:"#1A73E8" }
    ],
    security: [
      { l:"D", c:"#3CB371" }, { l:"O", c:"#007DC1" }, { l:"P", c:"#C0172C" },
      { l:"A", c:"#00B5AD" }, { l:"M", c:"#0067B8" }, { l:"C", c:"#D61F26" }
    ],
    enterprise: [
      { l:"S", c:"#00A1E0" }, { l:"W", c:"#1F5BFF" }, { l:"N", c:"#81B29A" },
      { l:"S", c:"#0A6ED1" }, { l:"N", c:"#C74634" }
    ]
  };

  function shade(hex, m) {
    const c = hex.replace("#","");
    const n = [0,1,2].map(i => parseInt(c.slice(i*2, i*2+2), 16));
    const s = n.map(v => Math.max(0, Math.min(255, Math.round(v*m))));
    return "#" + s.map(v => v.toString(16).padStart(2,"0")).join("");
  }

  function logo(letter, color, extraClass="") {
    return `
      <div class="app-node w-7 h-7 rounded-full grid place-items-center bg-white shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] ${extraClass}"
           title="${letter}" aria-label="${letter}" role="img">
        <svg viewBox="0 0 48 48" width="22" height="22" aria-hidden="true">
          <defs>
            <linearGradient id="g${letter}" x1="0" x2="1">
              <stop offset="0" stop-color="${shade(color,0.92)}" />
              <stop offset="1" stop-color="${shade(color,1.08)}" />
            </linearGradient>
          </defs>
          <rect x="3" y="3" width="42" height="42" rx="12" fill="url(#g${letter})" stroke="rgba(0,0,0,.12)"/>
          <text x="50%" y="58%" text-anchor="middle" font-size="22" font-family="Inter,Segoe UI,Arial" font-weight="800" fill="#0a1c60">${letter}</text>
        </svg>
      </div>
    `;
  }

  function buildCatalog() {
    $("cat-core").innerHTML = CATALOG.core.map((x,i) => logo(x.l, x.c, i===0 ? "js-startAnchor" : "")).join("");
    $("cat-security").innerHTML = CATALOG.security.map(x => logo(x.l, x.c)).join("");
    $("cat-enterprise").innerHTML = CATALOG.enterprise.map(x => logo(x.l, x.c)).join("");
  }

  function buildTiles(mountId, count, baseDelaySeconds) {
    const mount = $(mountId);
    if (!mount) return;
    mount.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const d = document.createElement("div");
      d.className = "tile";
      d.dataset.anim = "tilePulse";
      d.style.setProperty("--d", `${(baseDelaySeconds + i*0.10).toFixed(2)}s`);
      mount.appendChild(d);
    }
  }

  function buildFlow() {
    buildCatalog();

    buildTiles("flowConn0", 14, 2.7);
    buildTiles("flowConn1", 14, 3.2);
    buildTiles("flowConn2", 14, 3.7);

    buildTiles("flowGrp0", 16, 5.0);
    buildTiles("flowGrp1", 16, 5.4);
    buildTiles("flowGrp2", 16, 5.8);

    buildTiles("flowDev0", 10, 7.9);
    buildTiles("flowDev1", 10, 8.3);
    buildTiles("flowDev2", 10, 8.7);

    resetUI();
  }

  // Rider animation + route drawing
  let riderLottie = null;
  let riderMoveAnim = null;
  let routeTraceAnim = null;
  let running = false;
  let progressTimer = null;

  function ensureRiderLottie() {
    if (riderLottie || !window.lottie) return;
    riderLottie = window.lottie.loadAnimation({
      container: $("riderLottie"),
      renderer: "svg",
      loop: true,
      autoplay: false,
      path: RIDER_LOTTIE_URL,
      rendererSettings: { preserveAspectRatio: "xMidYMid slice", progressiveLoad: true }
    });
  }

  function centerPointWithin(containerEl, targetEl) {
    const c = containerEl.getBoundingClientRect();
    const t = targetEl.getBoundingClientRect();
    return {
      x: (t.left - c.left) + t.width / 2,
      y: (t.top - c.top) + t.height / 2
    };
  }

  function setRoutePathD(d) {
    $("routePath").setAttribute("d", d);
    $("routeGlow").setAttribute("d", d);
    $("routeTrace").setAttribute("d", d);
  }

  function drawAndAnimateRoute(flowEl, p0, p1, p2, p3, durationMs) {
    const w = flowEl.clientWidth;
    const h = flowEl.clientHeight;

    // normalize points into SVG viewBox units (0-100) to avoid resize weirdness
    const toV = (p) => ({ x: (p.x / w) * 100, y: (p.y / h) * 100 });

    const a = toV(p0), b = toV(p1), c = toV(p2), d = toV(p3);

    const pathD = `M ${a.x} ${a.y} C ${b.x} ${b.y}, ${c.x} ${c.y}, ${d.x} ${d.y}`;
    setRoutePathD(pathD);

    const trace = $("routeTrace");
    trace.style.opacity = "1";

    // animate stroke-dashoffset “drawing”
    const len = trace.getTotalLength();
    trace.style.strokeDasharray = String(len);
    trace.style.strokeDashoffset = String(len);

    if (routeTraceAnim) routeTraceAnim.cancel();
    routeTraceAnim = trace.animate(
      [{ strokeDashoffset: len }, { strokeDashoffset: 0 }],
      { duration: durationMs, easing: "linear", fill: "forwards" }
    );
  }

  function moveRiderAlong(flowEl, start, mid1, mid2, end, durationMs) {
    const rider = $("rider");
    rider.style.opacity = "1";

    // Put the rider so its center hits the points
    const riderW = rider.offsetWidth || 78;
    const riderH = rider.offsetHeight || 78;
    const place = (p) => ({ x: p.x - riderW/2, y: p.y - riderH/2 });

    const s = place(start), m1 = place(mid1), m2 = place(mid2), e = place(end);

    if (riderMoveAnim) riderMoveAnim.cancel();

    riderMoveAnim = rider.animate(
      [
        { transform: `translate(${s.x}px,${s.y}px) rotate(-4deg)` },
        { transform: `translate(${m1.x}px,${m1.y}px) rotate(-2deg)`, offset: 0.42 },
        { transform: `translate(${m2.x}px,${m2.y}px) rotate(2deg)`,  offset: 0.78 },
        { transform: `translate(${e.x}px,${e.y}px) rotate(0deg)` }
      ],
      { duration: durationMs, easing: "cubic-bezier(0.2,0.8,0.2,1)", fill: "forwards" }
    );
  }

  function runRiderTrip() {
    const flowEl = $("flowCard");
    const startEl = flowEl.querySelector(".js-startAnchor") || flowEl.querySelector(".app-node");
    const endEl = $("endUserAvatar");
    if (!flowEl || !startEl || !endEl) return;

    ensureRiderLottie();
    if (!prefersReducedMotion()) {
      try { riderLottie.play(); } catch {}
    }

    const start = centerPointWithin(flowEl, startEl);
    const end = centerPointWithin(flowEl, endEl);

    // control plane-ish midpoints (gives a purposeful “go through the middle” arc)
    const mid1 = { x: Math.max(start.x + 140, flowEl.clientWidth * 0.46), y: Math.max(70, start.y - 28) };
    const mid2 = { x: Math.min(end.x - 140, flowEl.clientWidth * 0.70), y: Math.min(flowEl.clientHeight - 90, end.y - 34) };

    const durationMs = 8200;

    drawAndAnimateRoute(flowEl, start, mid1, mid2, end, durationMs);
    moveRiderAlong(flowEl, start, mid1, mid2, end, durationMs);

    const rider = $("rider");
    rider.classList.add("show-bubble");
    setTimeout(() => rider.classList.remove("show-bubble"), 1400);
  }

  // Progress + completion
  const progress = { apps: 0, time: 0, tickets: 0 };

  function setCounter(id, v) { const el = $(id); if (el) el.textContent = String(v); }
  function updateProgress() {
    if (progress.apps < 128) progress.apps += 4;
    if (progress.time < 46) progress.time += 2;
    if (progress.tickets < 73) progress.tickets += 3;
    setCounter("appsProcessed", Math.min(progress.apps, 128));
    setCounter("timeSaved", Math.min(progress.time, 46));
    setCounter("ticketsAvoided", Math.min(progress.tickets, 73));
  }

  function fireConfetti() {
    if (!window.confetti) return;
    window.confetti({
      disableForReducedMotion: true,
      particleCount: 30,
      spread: 62,
      ticks: 150,
      gravity: 0.95,
      decay: 0.93,
      startVelocity: 28,
      scalar: 0.9,
      colors: ["#2563EB", "#93C5FD", "#E5E7EB", "#FFFFFF"],
      angle: 60,
      origin: { x: 0.12, y: 0.75 }
    });
    window.confetti({
      disableForReducedMotion: true,
      particleCount: 30,
      spread: 62,
      ticks: 150,
      gravity: 0.95,
      decay: 0.93,
      startVelocity: 28,
      scalar: 0.9,
      colors: ["#10B981", "#A7F3D0", "#E5E7EB", "#FFFFFF"],
      angle: 120,
      origin: { x: 0.88, y: 0.75 }
    });
  }

  function resetUI() {
    running = false;
    progress.apps = progress.time = progress.tickets = 0;

    $("btnStart").disabled = false;
    $("btnStart").classList.remove("opacity-60", "cursor-not-allowed");

    $("counters").classList.add("hidden");
    $("flowSuccess").classList.add("hidden");

    $("endUserCard").classList.remove("highlighted");
    $("endUserAvatar").classList.remove("bg-green-500");
    $("endUserAvatar").classList.add("bg-red-600");
    $("endUserAvatar").textContent = "U";
    $("endUserMessage").textContent = "Waiting on app readiness…";

    // route + rider
    $("routeTrace").style.opacity = "0";
    setRoutePathD("");
    const rider = $("rider");
    rider.style.opacity = "0";
    rider.style.transform = "translate(-9999px,-9999px)";
    rider.classList.remove("show-bubble");

    if (riderMoveAnim) { try { riderMoveAnim.cancel(); } catch {} riderMoveAnim = null; }
    if (routeTraceAnim) { try { routeTraceAnim.cancel(); } catch {} routeTraceAnim = null; }

    if (riderLottie) { try { riderLottie.stop(); } catch {} }

    // remove processed states
    document.querySelectorAll(".processed").forEach(el => el.classList.remove("processed"));

    // clear animation class
    const flow = $("flowCard");
    flow.classList.remove("run");

    setCounter("appsProcessed", 0);
    setCounter("timeSaved", 0);
    setCounter("ticketsAvoided", 0);

    if (progressTimer) { clearInterval(progressTimer); progressTimer = null; }
  }

  function startFlow() {
    if (running) return;
    running = true;

    $("btnStart").disabled = true;
    $("btnStart").classList.add("opacity-60", "cursor-not-allowed");

    $("counters").classList.remove("hidden");

    // restart CSS animations
    const flow = $("flowCard");
    flow.classList.remove("run");
    void flow.offsetWidth;
    flow.classList.add("run");

    // Rider trip is the hero: it *connects* the flow
    runRiderTrip();

    // bucket highlights (kept, but timed to feel “professional”)
    const platforms = document.querySelectorAll("#platformsSection > div");
    const groups = document.querySelectorAll("#groupsSection > div");
    const devices = document.querySelectorAll("#devicesSection > div");

    // start progress
    progressTimer = setInterval(updateProgress, 110);

    // staged "processed" marks
    setTimeout(() => platforms[0]?.classList.add("processed"), 4200);
    setTimeout(() => platforms[1]?.classList.add("processed"), 4700);
    setTimeout(() => platforms[2]?.classList.add("processed"), 5200);

    setTimeout(() => groups[0]?.classList.add("processed"), 6000);
    setTimeout(() => groups[1]?.classList.add("processed"), 6500);
    setTimeout(() => groups[2]?.classList.add("processed"), 7000);

    setTimeout(() => devices[0]?.classList.add("processed"), 7700);
    setTimeout(() => devices[1]?.classList.add("processed"), 8200);
    setTimeout(() => devices[2]?.classList.add("processed"), 8700);

    // Arrival + completion
    setTimeout(() => {
      $("endUserCard").classList.add("highlighted");
      $("endUserAvatar").classList.remove("bg-red-600");
      $("endUserAvatar").classList.add("bg-green-500");
      $("endUserAvatar").textContent = "✓";
      $("endUserMessage").textContent = "Delivered. User has the right app + policy immediately.";

      $("flowSuccess").classList.remove("hidden");
      fireConfetti();

      if (progressTimer) { clearInterval(progressTimer); progressTimer = null; }
    }, 9200);

    // unlock after finishing
    setTimeout(() => {
      running = false;
      $("btnStart").disabled = false;
      $("btnStart").classList.remove("opacity-60", "cursor-not-allowed");
    }, 9800);
  }

  function init() {
    if (window.lucide?.createIcons) {
      try { window.lucide.createIcons(); } catch {}
    }
    buildFlow();

    $("btnStart").addEventListener("click", startFlow);
    $("btnReset").addEventListener("click", resetUI);

    // keep rider route correct on resize (only matters for the next run)
    window.addEventListener("resize", () => {
      if (!running) {
        $("routeTrace").style.opacity = "0";
        setRoutePathD("");
      }
    }, { passive: true });
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
